Enhanced Diffutoon Jupyter Notebook


{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "view-in-github",
        "colab_type": "text"
      },
      "source": [
        "<a href=\"https://colab.research.google.com/github/bugonacci/diffutoon_colab/blob/main/Diffutoon_Colab_v1_0.ipynb\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "# Introduction\n",
        "\n",
        "Welcome to the enhanced version of the Diffutoon Jupyter notebook! Originally created by [camenduru](https://github.com/camenduru) ,\n",
        "\n",
        "I have taken the initiative to further develop this notebook to provide a more user-friendly experience.\n",
        "\n",
        "twitter / X: https://x.com/bugonacci\n",
        "\n",
        "github: https://github.com/bugonacci\n",
        "\n",
        "In this version, you'll find an intuitive interface equipped with user-friendly forms that allow you to configure and control various settings without the need to interact directly with the underlying code. My goal is to make it as easy as possible for users of all skill levels to harness the power of the Diffutoon pipeline, enhancing accessibility and simplifying the process of generating stunning visual content.\n",
        "\n",
        "Original notebook: https://colab.research.google.com/github/camenduru/Diffutoon-jupyter/blob/main/Diffutoon_jupyter.ipynb\n",
        "\n",
        "Enjoy your exploration and creation with this improved Colab notebook!"
      ],
      "metadata": {
        "id": "pH1AhfdDRs8U"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "# INSTALL ALL DEPENDENCIES"
      ],
      "metadata": {
        "id": "-83R1mA3O_mz"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "!pip install modelscope\n",
        "!pip install ipywidgets modelscope tqdm\n",
        "\n",
        "# https://github.com/modelscope/DiffSynth-Studio/blob/main/examples/Diffutoon/Diffutoon.ipynb modified\n",
        "\n",
        "%cd /content\n",
        "!git clone https://github.com/Artiprocher/DiffSynth-Studio\n",
        "%cd /content/DiffSynth-Studio\n",
        "\n",
        "!pip install -q einops transformers controlnet-aux==0.0.7 sentencepiece imageio imageio-ffmpeg\n",
        "\n",
        "!apt -y install -qq aria2\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://civitai.com/api/download/models/229575 -d /content/DiffSynth-Studio/models/stable_diffusion -o aingdiffusion_v12.safetensors\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/guoyww/animatediff/resolve/main/mm_sd_v15_v2.ckpt -d /content/DiffSynth-Studio/models/AnimateDiff -o mm_sd_v15_v2.ckpt\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/ControlNet-v1-1/resolve/main/control_v11p_sd15_lineart.pth -d /content/DiffSynth-Studio/models/ControlNet -o control_v11p_sd15_lineart.pth\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/ControlNet-v1-1/resolve/main/control_v11f1e_sd15_tile.pth -d /content/DiffSynth-Studio/models/ControlNet -o control_v11f1e_sd15_tile.pth\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/ControlNet-v1-1/resolve/main/control_v11f1p_sd15_depth.pth -d /content/DiffSynth-Studio/models/ControlNet -o control_v11f1p_sd15_depth.pth\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/ControlNet-v1-1/resolve/main/control_v11p_sd15_softedge.pth -d /content/DiffSynth-Studio/models/ControlNet -o control_v11p_sd15_softedge.pth\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/Annotators/resolve/main/dpt_hybrid-midas-501f0c75.pt -d /content/DiffSynth-Studio/models/Annotators -o dpt_hybrid-midas-501f0c75.pt\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/Annotators/resolve/main/ControlNetHED.pth -d /content/DiffSynth-Studio/models/Annotators -o ControlNetHED.pth\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/Annotators/resolve/main/sk_model.pth -d /content/DiffSynth-Studio/models/Annotators -o sk_model.pth\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/lllyasviel/Annotators/resolve/main/sk_model2.pth -d /content/DiffSynth-Studio/models/Annotators -o sk_model2.pth\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M \"https://civitai.com/api/download/models/25820?type=Model&format=PickleTensor&size=full&fp=fp16\" -d /content/DiffSynth-Studio/models/textual_inversion -o verybadimagenegative_v1.3.pt\n",
        "!aria2c --console-log-level=error -c -x 16 -s 16 -k 1M https://huggingface.co/camenduru/Diffutoon/resolve/main/input_video.mp4 -d /content -o input_video.mp4"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "nu4S8XFTJ2Gr",
        "outputId": "9aef9edb-6dc5-4dfc-b46f-a1bfadcad056"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Collecting modelscope\n",
            "  Downloading modelscope-1.16.1-py3-none-any.whl (5.7 MB)\n",
            "\u001b[?25l     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m0.0/5.7 MB\u001b[0m \u001b[31m?\u001b[0m eta \u001b[36m-:--:--\u001b[0m\r\u001b[2K     \u001b[91m━━━━\u001b[0m\u001b[91m╸\u001b[0m\u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m0.6/5.7 MB\u001b[0m \u001b[31m19.8 MB/s\u001b[0m eta \u001b[36m0:00:01\u001b[0m\r\u001b[2K     \u001b[91m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m\u001b[91m╸\u001b[0m \u001b[32m5.7/5.7 MB\u001b[0m \u001b[31m93.1 MB/s\u001b[0m eta \u001b[36m0:00:01\u001b[0m\r\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m5.7/5.7 MB\u001b[0m \u001b[31m61.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
            "\u001b[?25hRequirement already satisfied: requests>=2.25 in /usr/local/lib/python3.10/dist-packages (from modelscope) (2.31.0)\n",
            "Requirement already satisfied: tqdm>=4.64.0 in /usr/local/lib/python3.10/dist-packages (from modelscope) (4.66.4)\n",
            "Requirement already satisfied: urllib3>=1.26 in /usr/local/lib/python3.10/dist-packages (from modelscope) (2.0.7)\n",
            "Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests>=2.25->modelscope) (3.3.2)\n",
            "Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.25->modelscope) (3.7)\n",
            "Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.25->modelscope) (2024.7.4)\n",
            "Installing collected packages: modelscope\n",
            "Successfully installed modelscope-1.16.1\n",
            "Requirement already satisfied: ipywidgets in /usr/local/lib/python3.10/dist-packages (7.7.1)\n",
            "Requirement already satisfied: modelscope in /usr/local/lib/python3.10/dist-packages (1.16.1)\n",
            "Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (4.66.4)\n",
            "Requirement already satisfied: ipykernel>=4.5.1 in /usr/local/lib/python3.10/dist-packages (from ipywidgets) (5.5.6)\n",
            "Requirement already satisfied: ipython-genutils~=0.2.0 in /usr/local/lib/python3.10/dist-packages (from ipywidgets) (0.2.0)\n",
            "Requirement already satisfied: traitlets>=4.3.1 in /usr/local/lib/python3.10/dist-packages (from ipywidgets) (5.7.1)\n",
            "Requirement already satisfied: widgetsnbextension~=3.6.0 in /usr/local/lib/python3.10/dist-packages (from ipywidgets) (3.6.7)\n",
            "Requirement already satisfied: ipython>=4.0.0 in /usr/local/lib/python3.10/dist-packages (from ipywidgets) (7.34.0)\n",
            "Requirement already satisfied: jupyterlab-widgets>=1.0.0 in /usr/local/lib/python3.10/dist-packages (from ipywidgets) (3.0.11)\n",
            "Requirement already satisfied: requests>=2.25 in /usr/local/lib/python3.10/dist-packages (from modelscope) (2.31.0)\n",
            "Requirement already satisfied: urllib3>=1.26 in /usr/local/lib/python3.10/dist-packages (from modelscope) (2.0.7)\n",
            "Requirement already satisfied: jupyter-client in /usr/local/lib/python3.10/dist-packages (from ipykernel>=4.5.1->ipywidgets) (6.1.12)\n",
            "Requirement already satisfied: tornado>=4.2 in /usr/local/lib/python3.10/dist-packages (from ipykernel>=4.5.1->ipywidgets) (6.3.3)\n",
            "Requirement already satisfied: setuptools>=18.5 in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (67.7.2)\n",
            "Collecting jedi>=0.16 (from ipython>=4.0.0->ipywidgets)\n",
            "  Downloading jedi-0.19.1-py2.py3-none-any.whl (1.6 MB)\n",
            "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.6/1.6 MB\u001b[0m \u001b[31m10.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
            "\u001b[?25hRequirement already satisfied: decorator in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (4.4.2)\n",
            "Requirement already satisfied: pickleshare in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (0.7.5)\n",
            "Requirement already satisfied: prompt-toolkit!=3.0.0,!=3.0.1,<3.1.0,>=2.0.0 in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (3.0.47)\n",
            "Requirement already satisfied: pygments in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (2.16.1)\n",
            "Requirement already satisfied: backcall in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (0.2.0)\n",
            "Requirement already satisfied: matplotlib-inline in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (0.1.7)\n",
            "Requirement already satisfied: pexpect>4.3 in /usr/local/lib/python3.10/dist-packages (from ipython>=4.0.0->ipywidgets) (4.9.0)\n",
            "Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests>=2.25->modelscope) (3.3.2)\n",
            "Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.25->modelscope) (3.7)\n",
            "Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.25->modelscope) (2024.7.4)\n",
            "Requirement already satisfied: notebook>=4.4.1 in /usr/local/lib/python3.10/dist-packages (from widgetsnbextension~=3.6.0->ipywidgets) (6.5.5)\n",
            "Requirement already satisfied: parso<0.9.0,>=0.8.3 in /usr/local/lib/python3.10/dist-packages (from jedi>=0.16->ipython>=4.0.0->ipywidgets) (0.8.4)\n",
            "Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (3.1.4)\n",
            "Requirement already satisfied: pyzmq<25,>=17 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (24.0.1)\n",
            "Requirement already satisfied: argon2-cffi in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (23.1.0)\n",
            "Requirement already satisfied: jupyter-core>=4.6.1 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (5.7.2)\n",
            "Requirement already satisfied: nbformat in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (5.10.4)\n",
            "Requirement already satisfied: nbconvert>=5 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (6.5.4)\n",
            "Requirement already satisfied: nest-asyncio>=1.5 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.6.0)\n",
            "Requirement already satisfied: Send2Trash>=1.8.0 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.8.3)\n",
            "Requirement already satisfied: terminado>=0.8.3 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.18.1)\n",
            "Requirement already satisfied: prometheus-client in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.20.0)\n",
            "Requirement already satisfied: nbclassic>=0.4.7 in /usr/local/lib/python3.10/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.1.0)\n",
            "Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.10/dist-packages (from jupyter-client->ipykernel>=4.5.1->ipywidgets) (2.8.2)\n",
            "Requirement already satisfied: ptyprocess>=0.5 in /usr/local/lib/python3.10/dist-packages (from pexpect>4.3->ipython>=4.0.0->ipywidgets) (0.7.0)\n",
            "Requirement already satisfied: wcwidth in /usr/local/lib/python3.10/dist-packages (from prompt-toolkit!=3.0.0,!=3.0.1,<3.1.0,>=2.0.0->ipython>=4.0.0->ipywidgets) (0.2.13)\n",
            "Requirement already satisfied: platformdirs>=2.5 in /usr/local/lib/python3.10/dist-packages (from jupyter-core>=4.6.1->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (4.2.2)\n",
            "Requirement already satisfied: notebook-shim>=0.2.3 in /usr/local/lib/python3.10/dist-packages (from nbclassic>=0.4.7->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.2.4)\n",
            "Requirement already satisfied: lxml in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (4.9.4)\n",
            "Requirement already satisfied: beautifulsoup4 in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (4.12.3)\n",
            "Requirement already satisfied: bleach in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (6.1.0)\n",
            "Requirement already satisfied: defusedxml in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.7.1)\n",
            "Requirement already satisfied: entrypoints>=0.2.2 in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.4)\n",
            "Requirement already satisfied: jupyterlab-pygments in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.3.0)\n",
            "Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (2.1.5)\n",
            "Requirement already satisfied: mistune<2,>=0.8.1 in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.8.4)\n",
            "Requirement already satisfied: nbclient>=0.5.0 in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.10.0)\n",
            "Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (24.1)\n",
            "Requirement already satisfied: pandocfilters>=1.4.1 in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.5.1)\n",
            "Requirement already satisfied: tinycss2 in /usr/local/lib/python3.10/dist-packages (from nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.3.0)\n",
            "Requirement already satisfied: fastjsonschema>=2.15 in /usr/local/lib/python3.10/dist-packages (from nbformat->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (2.20.0)\n",
            "Requirement already satisfied: jsonschema>=2.6 in /usr/local/lib/python3.10/dist-packages (from nbformat->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (4.19.2)\n",
            "Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.1->jupyter-client->ipykernel>=4.5.1->ipywidgets) (1.16.0)\n",
            "Requirement already satisfied: argon2-cffi-bindings in /usr/local/lib/python3.10/dist-packages (from argon2-cffi->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (21.2.0)\n",
            "Requirement already satisfied: attrs>=22.2.0 in /usr/local/lib/python3.10/dist-packages (from jsonschema>=2.6->nbformat->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (23.2.0)\n",
            "Requirement already satisfied: jsonschema-specifications>=2023.03.6 in /usr/local/lib/python3.10/dist-packages (from jsonschema>=2.6->nbformat->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (2023.12.1)\n",
            "Requirement already satisfied: referencing>=0.28.4 in /usr/local/lib/python3.10/dist-packages (from jsonschema>=2.6->nbformat->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.35.1)\n",
            "Requirement already satisfied: rpds-py>=0.7.1 in /usr/local/lib/python3.10/dist-packages (from jsonschema>=2.6->nbformat->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.19.0)\n",
            "Requirement already satisfied: jupyter-server<3,>=1.8 in /usr/local/lib/python3.10/dist-packages (from notebook-shim>=0.2.3->nbclassic>=0.4.7->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.24.0)\n",
            "Requirement already satisfied: cffi>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from argon2-cffi-bindings->argon2-cffi->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.16.0)\n",
            "Requirement already satisfied: soupsieve>1.2 in /usr/local/lib/python3.10/dist-packages (from beautifulsoup4->nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (2.5)\n",
            "Requirement already satisfied: webencodings in /usr/local/lib/python3.10/dist-packages (from bleach->nbconvert>=5->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (0.5.1)\n",
            "Requirement already satisfied: pycparser in /usr/local/lib/python3.10/dist-packages (from cffi>=1.0.1->argon2-cffi-bindings->argon2-cffi->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (2.22)\n",
            "Requirement already satisfied: anyio<4,>=3.1.0 in /usr/local/lib/python3.10/dist-packages (from jupyter-server<3,>=1.8->notebook-shim>=0.2.3->nbclassic>=0.4.7->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (3.7.1)\n",
            "Requirement already satisfied: websocket-client in /usr/local/lib/python3.10/dist-packages (from jupyter-server<3,>=1.8->notebook-shim>=0.2.3->nbclassic>=0.4.7->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.8.0)\n",
            "Requirement already satisfied: sniffio>=1.1 in /usr/local/lib/python3.10/dist-packages (from anyio<4,>=3.1.0->jupyter-server<3,>=1.8->notebook-shim>=0.2.3->nbclassic>=0.4.7->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.3.1)\n",
            "Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio<4,>=3.1.0->jupyter-server<3,>=1.8->notebook-shim>=0.2.3->nbclassic>=0.4.7->notebook>=4.4.1->widgetsnbextension~=3.6.0->ipywidgets) (1.2.2)\n",
            "Installing collected packages: jedi\n",
            "Successfully installed jedi-0.19.1\n",
            "/content\n",
            "Cloning into 'DiffSynth-Studio'...\n",
            "remote: Enumerating objects: 755, done.\u001b[K\n",
            "remote: Counting objects: 100% (234/234), done.\u001b[K\n",
            "remote: Compressing objects: 100% (89/89), done.\u001b[K\n",
            "remote: Total 755 (delta 169), reused 145 (delta 145), pack-reused 521\u001b[K\n",
            "Receiving objects: 100% (755/755), 4.99 MiB | 9.89 MiB/s, done.\n",
            "Resolving deltas: 100% (441/441), done.\n",
            "/content/DiffSynth-Studio\n",
            "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m43.2/43.2 kB\u001b[0m \u001b[31m2.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
            "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m202.4/202.4 kB\u001b[0m \u001b[31m6.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
            "\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
            "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.3/2.3 MB\u001b[0m \u001b[31m13.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
            "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m21.3/21.3 MB\u001b[0m \u001b[31m56.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
            "\u001b[?25h  Building wheel for controlnet-aux (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
            "The following additional packages will be installed:\n",
            "  libaria2-0 libc-ares2\n",
            "The following NEW packages will be installed:\n",
            "  aria2 libaria2-0 libc-ares2\n",
            "0 upgraded, 3 newly installed, 0 to remove and 45 not upgraded.\n",
            "Need to get 1,513 kB of archives.\n",
            "After this operation, 5,441 kB of additional disk space will be used.\n",
            "Selecting previously unselected package libc-ares2:amd64.\n",
            "(Reading database ... 123589 files and directories currently installed.)\n",
            "Preparing to unpack .../libc-ares2_1.18.1-1ubuntu0.22.04.3_amd64.deb ...\n",
            "Unpacking libc-ares2:amd64 (1.18.1-1ubuntu0.22.04.3) ...\n",
            "Selecting previously unselected package libaria2-0:amd64.\n",
            "Preparing to unpack .../libaria2-0_1.36.0-1_amd64.deb ...\n",
            "Unpacking libaria2-0:amd64 (1.36.0-1) ...\n",
            "Selecting previously unselected package aria2.\n",
            "Preparing to unpack .../aria2_1.36.0-1_amd64.deb ...\n",
            "Unpacking aria2 (1.36.0-1) ...\n",
            "Setting up libc-ares2:amd64 (1.18.1-1ubuntu0.22.04.3) ...\n",
            "Setting up libaria2-0:amd64 (1.36.0-1) ...\n",
            "Setting up aria2 (1.36.0-1) ...\n",
            "Processing triggers for man-db (2.10.2-1) ...\n",
            "Processing triggers for libc-bin (2.35-0ubuntu3.4) ...\n",
            "/sbin/ldconfig.real: /usr/local/lib/libtbb.so.12 is not a symbolic link\n",
            "\n",
            "/sbin/ldconfig.real: /usr/local/lib/libtbbbind_2_0.so.3 is not a symbolic link\n",
            "\n",
            "/sbin/ldconfig.real: /usr/local/lib/libtbbmalloc.so.2 is not a symbolic link\n",
            "\n",
            "/sbin/ldconfig.real: /usr/local/lib/libtbbbind.so.3 is not a symbolic link\n",
            "\n",
            "/sbin/ldconfig.real: /usr/local/lib/libtbbmalloc_proxy.so.2 is not a symbolic link\n",
            "\n",
            "/sbin/ldconfig.real: /usr/local/lib/libtbbbind_2_5.so.3 is not a symbolic link\n",
            "\n",
            "\n",
            "07/23 15:58:38 [\u001b[1;31mERROR\u001b[0m] CUID#7 - Download aborted. URI=https://civitai.com/api/download/models/229575\n",
            "Exception: [AbstractCommand.cc:351] errorCode=29 URI=https://civitai.com/api/download/models/229575\n",
            "  -> [HttpSkipResponseCommand.cc:231] errorCode=29 The response status is not successful. status=503\n",
            "\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "d6d071|\u001b[1;31mERR\u001b[0m |       0B/s|/content/DiffSynth-Studio/models/stable_diffusion/aingdiffusion_v12.safetensors\n",
            "\n",
            "Status Legend:\n",
            "(ERR):error occurred.\n",
            "\n",
            "aria2 will resume download if the transfer is restarted.\n",
            "If there are any errors, then see the log file. See '-l' option in help/man page for details.\n",
            "\u001b[0m\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "3af4ec|\u001b[1;32mOK\u001b[0m  |   375MiB/s|/content/DiffSynth-Studio/models/AnimateDiff/mm_sd_v15_v2.ckpt\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\u001b[0m\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "bd1b8c|\u001b[1;32mOK\u001b[0m  |   504MiB/s|/content/DiffSynth-Studio/models/ControlNet/control_v11p_sd15_lineart.pth\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\u001b[0m\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "abe608|\u001b[1;32mOK\u001b[0m  |   484MiB/s|/content/DiffSynth-Studio/models/ControlNet/control_v11f1e_sd15_tile.pth\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\u001b[0m\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "3442eb|\u001b[1;32mOK\u001b[0m  |   466MiB/s|/content/DiffSynth-Studio/models/ControlNet/control_v11f1p_sd15_depth.pth\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\u001b[0m\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "803f0a|\u001b[1;32mOK\u001b[0m  |   455MiB/s|/content/DiffSynth-Studio/models/ControlNet/control_v11p_sd15_softedge.pth\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\u001b[0m\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "168866|\u001b[1;32mOK\u001b[0m  |   280MiB/s|/content/DiffSynth-Studio/models/Annotators/dpt_hybrid-midas-501f0c75.pt\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "3286cf|\u001b[1;32mOK\u001b[0m  |    40MiB/s|/content/DiffSynth-Studio/models/Annotators/ControlNetHED.pth\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "b67b35|\u001b[1;32mOK\u001b[0m  |    44MiB/s|/content/DiffSynth-Studio/models/Annotators/sk_model.pth\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "dac1f0|\u001b[1;32mOK\u001b[0m  |    45MiB/s|/content/DiffSynth-Studio/models/Annotators/sk_model2.pth\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n",
            "\n",
            "07/23 15:59:14 [\u001b[1;31mERROR\u001b[0m] CUID#7 - Download aborted. URI=https://civitai.com/api/download/models/25820?type=Model&format=PickleTensor&size=full&fp=fp16\n",
            "Exception: [AbstractCommand.cc:351] errorCode=29 URI=https://civitai.com/api/download/models/25820?type=Model&format=PickleTensor&size=full&fp=fp16\n",
            "  -> [HttpSkipResponseCommand.cc:231] errorCode=29 The response status is not successful. status=503\n",
            "\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "c5cdcc|\u001b[1;31mERR\u001b[0m |       0B/s|/content/DiffSynth-Studio/models/textual_inversion/verybadimagenegative_v1.3.pt\n",
            "\n",
            "Status Legend:\n",
            "(ERR):error occurred.\n",
            "\n",
            "aria2 will resume download if the transfer is restarted.\n",
            "If there are any errors, then see the log file. See '-l' option in help/man page for details.\n",
            "\n",
            "Download Results:\n",
            "gid   |stat|avg speed  |path/URI\n",
            "======+====+===========+=======================================================\n",
            "cb918c|\u001b[1;32mOK\u001b[0m  |    43MiB/s|/content/input_video.mp4\n",
            "\n",
            "Status Legend:\n",
            "(OK):download completed.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "# MODEL SETUP AND DOWNLOAD"
      ],
      "metadata": {
        "id": "Y_MIfttKPPYp"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "#@markdown ### Model Setup and Download\n",
        "#@markdown Select the models to download:\n",
        "download_stable_diffusion = True #@param {type:\"boolean\"}\n",
        "download_AnimateDiff = True #@param {type:\"boolean\"}\n",
        "\n",
        "#@markdown **Download Settings:**\n",
        "use_aria2 = True #@param {type:\"boolean\"} {\"tooltip\":\"Use aria2 for faster downloads\"}\n",
        "max_connections = 16 #@param {type:\"slider\", min:1, max:32, step:1}\n",
        "min_split_size = \"1M\" #@param [\"1M\", \"5M\", \"10M\", \"20M\"]\n",
        "\n",
        "#@markdown **Advanced Settings:**\n",
        "auto_retry = False #@param {type:\"boolean\"} {\"tooltip\":\"Automatically retry failed downloads\"}\n",
        "retry_count = 3 #@param {type:\"slider\", min:1, max:10, step:1}\n",
        "\n",
        "import os\n",
        "\n",
        "# Function to execute model setup and downloads\n",
        "def setup_and_download():\n",
        "    os.system(\"cd /content\")\n",
        "    os.system(\"git clone https://github.com/Artiprocher/DiffSynth-Studio\")\n",
        "    os.system(\"cd /content/DiffSynth-Studio\")\n",
        "    os.system(\"pip install -q einops transformers controlnet-aux==0.0.7 sentencepiece imageio imageio-ffmpeg\")\n",
        "    os.system(\"apt -y install -qq aria2\")\n",
        "\n",
        "    # Dictionary of model URLs and file names\n",
        "    models_info = {\n",
        "        \"stable_diffusion\": {\n",
        "            \"url\": \"https://civitai.com/api/download/models/229575\",\n",
        "            \"output\": \"aingdiffusion_v12.safetensors\"\n",
        "        },\n",
        "        \"AnimateDiff\": {\n",
        "            \"url\": \"https://huggingface.co/guoyww/animatediff/resolve/main/mm_sd_v15_v2.ckpt\",\n",
        "            \"output\": \"mm_sd_v15_v2.ckpt\"\n",
        "        },\n",
        "        # Add more models here as needed\n",
        "    }\n",
        "\n",
        "    # Download selected models\n",
        "    def download_model(model_key):\n",
        "        if model_key in models_info:\n",
        "            info = models_info[model_key]\n",
        "            full_path = f\"/content/DiffSynth-Studio/models/{model_key}\"\n",
        "            os.makedirs(full_path, exist_ok=True)\n",
        "            download_command = f\"aria2c --console-log-level=error -c -x {max_connections} -s {max_connections} -k {min_split_size} {info['url']} -d {full_path} -o {info['output']}\"\n",
        "            if not use_aria2:\n",
        "                download_command = f\"wget {info['url']} -O {full_path}/{info['output']}\"\n",
        "            os.system(download_command)\n",
        "            print(f\"Downloaded {model_key} model.\")\n",
        "\n",
        "    if download_stable_diffusion:\n",
        "        download_model(\"stable_diffusion\")\n",
        "\n",
        "    if download_AnimateDiff:\n",
        "        download_model(\"AnimateDiff\")\n",
        "\n",
        "    if auto_retry:\n",
        "        for _ in range(retry_count):\n",
        "            if download_stable_diffusion:\n",
        "                download_model(\"stable_diffusion\")\n",
        "            if download_AnimateDiff:\n",
        "                download_model(\"AnimateDiff\")\n",
        "\n",
        "    print(\"Selected models downloaded and installed.\")\n",
        "\n",
        "# Run the function to setup and download models\n",
        "setup_and_download()\n"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "cellView": "form",
        "id": "mqNjaPwvKwZu",
        "outputId": "9070ed9b-9ca1-4fa6-a407-774281555b8e"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Downloaded stable_diffusion model.\n",
            "Downloaded AnimateDiff model.\n",
            "Selected models downloaded and installed.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 322
        },
        "id": "XrtMysRY5AM_",
        "outputId": "0a8a03c2-51e6-4583-f0c8-e7246fc08d8e",
        "cellView": "form"
      },
      "outputs": [
        {
          "output_type": "error",
          "ename": "HTTPError",
          "evalue": "503 Server Error: Service Unavailable for url: https://civitai.com/api/download/models/224732?type=Model&format=SafeTensor&size=pruned&fp=fp16",
          "traceback": [
            "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
            "\u001b[0;31mHTTPError\u001b[0m                                 Traceback (most recent call last)",
            "\u001b[0;32m<ipython-input-3-95c82360dbf3>\u001b[0m in \u001b[0;36m<cell line: 34>\u001b[0;34m()\u001b[0m\n\u001b[1;32m     32\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     33\u001b[0m \u001b[0;31m# Call the download function\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 34\u001b[0;31m \u001b[0mdownload_model\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmodel_url\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mtarget_file\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
            "\u001b[0;32m<ipython-input-3-95c82360dbf3>\u001b[0m in \u001b[0;36mdownload_model\u001b[0;34m(url, output_path)\u001b[0m\n\u001b[1;32m     18\u001b[0m     \u001b[0;31m# Stream download with progress bar\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     19\u001b[0m     \u001b[0mresponse\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mrequests\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mget\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0murl\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mstream\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 20\u001b[0;31m     \u001b[0mresponse\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mraise_for_status\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m  \u001b[0;31m# Check that the request was successful\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     21\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     22\u001b[0m     \u001b[0;31m# Get the total file size from the response headers\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;32m/usr/local/lib/python3.10/dist-packages/requests/models.py\u001b[0m in \u001b[0;36mraise_for_status\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m   1019\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1020\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mhttp_error_msg\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1021\u001b[0;31m             \u001b[0;32mraise\u001b[0m \u001b[0mHTTPError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mhttp_error_msg\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mresponse\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1022\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1023\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mclose\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;31mHTTPError\u001b[0m: 503 Server Error: Service Unavailable for url: https://civitai.com/api/download/models/224732?type=Model&format=SafeTensor&size=pruned&fp=fp16"
          ]
        }
      ],
      "source": [
        "#@markdown ### Model Download Configuration\n",
        "model_url = \"https://civitai.com/api/download/models/224732?type=Model&format=SafeTensor&size=pruned&fp=fp16\" #@param {type:\"string\"}\n",
        "target_directory = \"/content/DiffSynth-Studio/models/stable_diffusion\" #@param {type:\"string\"}\n",
        "file_name = \"AniMesh.safetensors\" #@param {type:\"string\"}\n",
        "\n",
        "import os\n",
        "import requests\n",
        "from tqdm.notebook import tqdm\n",
        "\n",
        "# Define the full target path for the file\n",
        "target_file = os.path.join(target_directory, file_name)\n",
        "\n",
        "# Create the directory if it does not exist\n",
        "os.makedirs(target_directory, exist_ok=True)\n",
        "\n",
        "# Function to download the model\n",
        "def download_model(url, output_path):\n",
        "    # Stream download with progress bar\n",
        "    response = requests.get(url, stream=True)\n",
        "    response.raise_for_status()  # Check that the request was successful\n",
        "\n",
        "    # Get the total file size from the response headers\n",
        "    total_size = int(response.headers.get('content-length', 0))\n",
        "\n",
        "    # Write the file to the target location with progress bar\n",
        "    with open(output_path, 'wb') as f:\n",
        "        for chunk in tqdm(response.iter_content(chunk_size=8192), total=total_size//8192, unit='KB', unit_scale=True):\n",
        "            if chunk:  # Filter out keep-alive new chunks\n",
        "                f.write(chunk)\n",
        "\n",
        "    print(f\"Model downloaded and saved to {output_path}\")\n",
        "\n",
        "# Call the download function\n",
        "download_model(model_url, target_file)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "9SLm0x_n6UB1",
        "cellView": "form"
      },
      "outputs": [],
      "source": [
        "#@markdown ### Model Download Configuration for \"lora\"\n",
        "model_url = \"https://civitai.com/api/download/models/339595?type=Model&format=SafeTensor\" #@param {type:\"string\"}\n",
        "target_directory = \"/content/DiffSynth-Studio/models/lora\" #@param {type:\"string\"}\n",
        "file_name = \"Anime Outline.safetensors\" #@param {type:\"string\"}\n",
        "\n",
        "import os\n",
        "import requests\n",
        "from tqdm.notebook import tqdm\n",
        "\n",
        "# Define the full target path for the file\n",
        "target_file = os.path.join(target_directory, file_name)\n",
        "\n",
        "# Create the directory if it does not exist\n",
        "os.makedirs(target_directory, exist_ok=True)\n",
        "\n",
        "# Function to download the model\n",
        "def download_model(url, output_path):\n",
        "    # Stream download with progress bar\n",
        "    response = requests.get(url, stream=True)\n",
        "    response.raise_for_status()  # Check that the request was successful\n",
        "\n",
        "    # Get the total file size from the response headers\n",
        "    total_size = int(response.headers.get('content-length', 0))\n",
        "\n",
        "    # Write the file to the target location with progress bar\n",
        "    with open(output_path, 'wb') as f:\n",
        "        for chunk in tqdm(response.iter_content(chunk_size=8192), total=total_size//8192, unit='KB', unit_scale=True):\n",
        "            if chunk:  # Filter out keep-alive new chunks\n",
        "                f.write(chunk)\n",
        "\n",
        "    print(f\"Model downloaded and saved to {output_path}\")\n",
        "\n",
        "# Call the download function\n",
        "download_model(model_url, target_file)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "GWNwiqoZxQw4",
        "cellView": "form"
      },
      "outputs": [],
      "source": [
        "#@markdown ### General Model Configuration\n",
        "device = 'cuda' #@param [\"cuda\", \"cpu\"]\n",
        "input_video_file = \"/content/input_video.mp4\" #@param {type:\"string\"}\n",
        "output_folder = \"/content/output\" #@param {type:\"string\"}\n",
        "fps = 25 #@param {type:\"integer\"}\n",
        "\n",
        "#@markdown ### Processing Parameters\n",
        "seed = 0 #@param {type:\"integer\"}\n",
        "prompt = \"animated cartoon clay character, character cartoon made of clay, clay material, clay, clay toon, 3D clay, animated\" #@param {type:\"string\"}\n",
        "negative_prompt = \"verybadimagenegative_v1.3\" #@param {type:\"string\"}\n",
        "cfg_scale = 8.0 #@param {type:\"number\"}\n",
        "clip_skip = 2 #@param {type:\"slider\", min:0, max:10, step:1}\n",
        "denoising_strength = 1.0 #@param {type:\"number\"}\n",
        "num_inference_steps = 20 #@param {type:\"slider\", min:5, max:50, step:1}\n",
        "animatediff_batch_size = 24 #@param {type:\"integer\"}\n",
        "animatediff_stride = 10 #@param {type:\"integer\"}\n",
        "unet_batch_size = 2 #@param {type:\"integer\"}\n",
        "controlnet_batch_size = 2 #@param {type:\"integer\"}\n",
        "cross_frame_attention = False #@param {type:\"boolean\"}\n",
        "\n",
        "# Construct the complex configuration JSON\n",
        "config_stage_2_template = {\n",
        "    \"models\": {\n",
        "        \"model_list\": [\n",
        "            \"models/stable_diffusion/epiCRealism.safetensors\",\n",
        "            \"models/AnimateDiff/mm_sd_v15_v2.ckpt\",\n",
        "            \"models/ControlNet/control_v11f1e_sd15_tile.pth\",\n",
        "            \"models/ControlNet/control_v11p_sd15_lineart.pth\"\n",
        "        ],\n",
        "        \"textual_inversion_folder\": \"models/textual_inversion\",\n",
        "        \"device\": device,\n",
        "        \"lora_alphas\": [\n",
        "            {\n",
        "                \"model\": \"models/lora/ClayAnimation.safetensors\",\n",
        "                \"scale\": 2.0\n",
        "            },\n",
        "        ],\n",
        "        \"controlnet_units\": [\n",
        "            {\n",
        "                \"processor_id\": \"tile\",\n",
        "                \"model_path\": \"models/ControlNet/control_v11f1e_sd15_tile.pth\",\n",
        "                \"scale\": 1.0\n",
        "            },\n",
        "            {\n",
        "                \"processor_id\": \"lineart\",\n",
        "                \"model_path\": \"models/ControlNet/control_v11p_sd15_lineart.pth\",\n",
        "                \"scale\": 1.0\n",
        "            }\n",
        "        ]\n",
        "    },\n",
        "    \"data\": {\n",
        "        \"input_frames\": {\n",
        "            \"video_file\": input_video_file,\n",
        "            \"image_folder\": None,\n",
        "            \"height\": 768,\n",
        "            \"width\": 768,\n",
        "            \"start_frame_id\": 0,\n",
        "            \"end_frame_id\": 64\n",
        "        },\n",
        "        \"controlnet_frames\": [\n",
        "            {\n",
        "                \"video_file\": input_video_file,\n",
        "                \"image_folder\": None,\n",
        "                \"height\": 768,\n",
        "                \"width\": 768,\n",
        "                \"start_frame_id\": 0,\n",
        "                \"end_frame_id\": 64\n",
        "            },\n",
        "            {\n",
        "                \"video_file\": input_video_file,\n",
        "                \"image_folder\": None,\n",
        "                \"height\": 768,\n",
        "                \"width\": 768,\n",
        "                \"start_frame_id\": 0,\n",
        "                \"end_frame_id\": 64\n",
        "            }\n",
        "        ],\n",
        "        \"output_folder\": output_folder,\n",
        "        \"fps\": fps\n",
        "    },\n",
        "    \"pipeline\": {\n",
        "        \"seed\": seed,\n",
        "        \"pipeline_inputs\": {\n",
        "            \"prompt\": prompt,\n",
        "            \"negative_prompt\": negative_prompt,\n",
        "            \"cfg_scale\": cfg_scale,\n",
        "            \"clip_skip\": clip_skip,\n",
        "            \"denoising_strength\": denoising_strength,\n",
        "            \"num_inference_steps\": num_inference_steps,\n",
        "            \"animatediff_batch_size\": animatediff_batch_size,\n",
        "            \"animatediff_stride\": animatediff_stride,\n",
        "            \"unet_batch_size\": unet_batch_size,\n",
        "            \"controlnet_batch_size\": controlnet_batch_size,\n",
        "            \"cross_frame_attention\": cross_frame_attention,\n",
        "            # The following parameters will be overwritten. You don't need to modify them.\n",
        "            \"input_frames\": [],\n",
        "            \"num_frames\": 30,\n",
        "            \"width\": 768,\n",
        "            \"height\": 768,\n",
        "            \"controlnet_frames\": []\n",
        "        }\n",
        "    }\n",
        "}\n",
        "\n",
        "# Print out the configuration for verification\n",
        "print(config_stage_2_template)"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "# RUN"
      ],
      "metadata": {
        "id": "PHl_XtTZR8LY"
      }
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "mjnMbiRmxQw5",
        "cellView": "form"
      },
      "outputs": [],
      "source": [
        "#@markdown ### Video Input Configuration\n",
        "video_file = \"/content/input_video.mp4\" #@param {type:\"string\"}\n",
        "output_folder = \"/content/toon_video\" #@param {type:\"string\"}\n",
        "start_frame_id = 0 #@param {type:\"integer\"}\n",
        "end_frame_id = 64 #@param {type:\"integer\"}\n",
        "frame_height = 768 #@param {type:\"integer\"}\n",
        "frame_width = 768 #@param {type:\"integer\"}\n",
        "fps = 25 #@param {type:\"integer\"}\n",
        "\n",
        "from diffsynth import SDVideoPipelineRunner\n",
        "\n",
        "# Load the base configuration\n",
        "config_stage_2_template = {\n",
        "    \"models\": {\n",
        "        \"model_list\": [\n",
        "            \"models/stable_diffusion/epiCRealism.safetensors\",\n",
        "            \"models/AnimateDiff/mm_sd_v15_v2.ckpt\",\n",
        "            \"models/ControlNet/control_v11f1e_sd15_tile.pth\",\n",
        "            \"models/ControlNet/control_v11p_sd15_lineart.pth\"\n",
        "        ],\n",
        "        \"textual_inversion_folder\": \"models/textual_inversion\",\n",
        "        \"device\": \"cuda\",\n",
        "        \"lora_alphas\": [\n",
        "            {\n",
        "                \"model\": \"models/lora/ClayAnimation.safetensors\",\n",
        "                \"scale\": 2.0\n",
        "            },\n",
        "        ],\n",
        "        \"controlnet_units\": [\n",
        "            {\n",
        "                \"processor_id\": \"tile\",\n",
        "                \"model_path\": \"models/ControlNet/control_v11f1e_sd15_tile.pth\",\n",
        "                \"scale\": 1.0\n",
        "            },\n",
        "            {\n",
        "                \"processor_id\": \"lineart\",\n",
        "                \"model_path\": \"models/ControlNet/control_v11p_sd15_lineart.pth\",\n",
        "                \"scale\": 1.0\n",
        "            }\n",
        "        ]\n",
        "    },\n",
        "    \"data\": {\n",
        "        \"input_frames\": {\n",
        "            \"video_file\": video_file,\n",
        "            \"image_folder\": None,\n",
        "            \"height\": frame_height,\n",
        "            \"width\": frame_width,\n",
        "            \"start_frame_id\": start_frame_id,\n",
        "            \"end_frame_id\": end_frame_id\n",
        "        },\n",
        "        \"controlnet_frames\": [\n",
        "            {\n",
        "                \"video_file\": video_file,\n",
        "                \"image_folder\": None,\n",
        "                \"height\": frame_height,\n",
        "                \"width\": frame_width,\n",
        "                \"start_frame_id\": start_frame_id,\n",
        "                \"end_frame_id\": end_frame_id\n",
        "            },\n",
        "            {\n",
        "                \"video_file\": video_file,\n",
        "                \"image_folder\": None,\n",
        "                \"height\": frame_height,\n",
        "                \"width\": frame_width,\n",
        "                \"start_frame_id\": start_frame_id,\n",
        "                \"end_frame_id\": end_frame_id\n",
        "            }\n",
        "        ],\n",
        "        \"output_folder\": output_folder,\n",
        "        \"fps\": fps\n",
        "    },\n",
        "    \"pipeline\": {\n",
        "        \"seed\": 0,\n",
        "        \"pipeline_inputs\": {\n",
        "            \"prompt\": \"animated cartoon clay character, character cartoon made of clay, clay material, clay, clay toon, 3D clay, animated\",\n",
        "            \"negative_prompt\": \"verybadimagenegative_v1.3\",\n",
        "            \"cfg_scale\": 8.0,\n",
        "            \"clip_skip\": 2,\n",
        "            \"denoising_strength\": 1.0,\n",
        "            \"num_inference_steps\": 20,\n",
        "            \"animatediff_batch_size\": 24,\n",
        "            \"animatediff_stride\": 10,\n",
        "            \"unet_batch_size\": 2,\n",
        "            \"controlnet_batch_size\": 2,\n",
        "            \"cross_frame_attention\": False,\n",
        "            \"input_frames\": [],\n",
        "            \"num_frames\": 30,\n",
        "            \"width\": frame_width,\n",
        "            \"height\": frame_height,\n",
        "            \"controlnet_frames\": []\n",
        "        }\n",
        "    }\n",
        "}\n",
        "\n",
        "# Create and run the video pipeline runner\n",
        "runner = SDVideoPipelineRunner()\n",
        "runner.run(config_stage_2_template)"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "# WATCH PREVIEW and EJOY!"
      ],
      "metadata": {
        "id": "SMbF28Q3SJ7F"
      }
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "w-wOV0ZHxQw6",
        "cellView": "form"
      },
      "outputs": [],
      "source": [
        "#@markdown ### Display Processed Video\n",
        "video_path = \"/content/toon_video/video.mp4\" #@param {type:\"string\"}\n",
        "\n",
        "import moviepy.editor as mp\n",
        "\n",
        "# Display the video in the notebook\n",
        "video_clip = mp.VideoFileClip(video_path)\n",
        "video_clip.ipython_display(fps=24, maxduration=240)"
      ]
    }
  ],
  "metadata": {
    "accelerator": "GPU",
    "colab": {
      "gpuType": "L4",
      "machine_shape": "hm",
      "provenance": [],
      "collapsed_sections": [
        "-83R1mA3O_mz",
        "Y_MIfttKPPYp",
        "PHl_XtTZR8LY",
        "SMbF28Q3SJ7F"
      ],
      "include_colab_link": true
    },
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    },
    "language_info": {
      "name": "python"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}
Introduction

Welcome to the enhanced version of the Diffutoon Jupyter notebook! Originally created by camenduru.
I have taken the initiative to further develop this notebook to provide a more user-friendly experience.

In this version, you'll find an intuitive interface equipped with user-friendly forms that allow you to configure and control various settings without the need to interact directly with the underlying code. My goal is to make it as easy as possible for users of all skill levels to harness the power of the Diffutoon pipeline, enhancing accessibility and simplifying the process of generating stunning visual content.
Features

- User-Friendly Forms: Easily configure and run complex pipelines with a simple, intuitive UI.
- Enhanced Accessibility: Making the powerful Diffutoon pipeline accessible to users regardless of their coding expertise.
- Seamless Integration: Run the notebook directly from Google Colab with minimal setup.

Quick Start

- Open the Notebook: Click here to access the Enhanced Diffutoon Notebook.
- Configure Settings: Use the interactive forms to set up your processing pipeline.
- Run and Enjoy: Execute the notebook and watch as your configurations come to life, generating visually appealing results.

Connect with Me

    Twitter/X: https://x.com/bugonacci
    GitHub: https://github.com/bugonacci

Original Notebook

For reference or to see the original version, visit the Original Diffutoon Notebook. https://colab.research.google.com/github/camenduru/Diffutoon-jupyter/blob/main/Diffutoon_jupyter.ipynb

Enjoy Your Exploration and Creation

Thank you for visiting and using the Enhanced Diffutoon Notebook. Enjoy exploring and creating stunning visual content with ease!
